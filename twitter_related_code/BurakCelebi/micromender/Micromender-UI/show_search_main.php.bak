<?php include_once 'preprocess.php'; ?>

<?php include 'show_search_common.php';?>

<!----------------------------------------- <user_rank_table> ------------------------------------------------------------------------------->
	
          <script>
            $(function () {
              $("a[rel=popover]")
                .popover({
                  offset: 10
                })
                .click(function(e) {
                  e.preventDefault()
                })
            })
          </script>

<a id="rankTableAnchor"></a><p>&nbsp;</p>
<script>
  		$(function() {
    		$("table#rankTable").tablesorter({ sortList: [[0,0]] });
  		});
</script>
<table id="rankTable" class="zebra-striped">
<thead><tr>
	<th>Rank</th>
	<th>Score</th>
	<th>Screen Name [Statuses]</th>
	<th>Iteration</th>
	<th>Followers / Friends</th>
	<th>Socialness</th>
	<th>Feedness</th>
	<th>Retweeted Mean</th>
	<th>Retweet Ratio</th>
	<th>Term Variation</th>
	<th>Relateness</th>
	<th>Avg Rating of Related Tweets</th>
	<th>New Score</th>
	<th>New Score * Score</th>
</tr></thead>
<tbody>
<?php 
$result = mysql_query('SELECT screen_name, name, statuses_count, followers_count, friends_count, location, format(score, 4) score, format(chattiness,3) chattiness, format(feedness,3) feedness, format(retweeted_mean,3) retweeted_mean, format(retweet_ratio,3) retweet_ratio, format(term_variation,3) term_variation, format(search_relateness,3) search_relateness, format(rating_of_related_tweets,3) rating_of_related_tweets, (select min(type) from t_search_result where search_id = u.search_id and screen_name = u.screen_name and type <> 1) iter from t_user u where search_id = ' . $searchId . ' order by score desc;');
$rowId = 1;
while($row = mysql_fetch_array($result)) {
	echo '<tr>'
	. '<td>' . $rowId++  . '</td>' 
	. append_td('Score', $row['score'])
	. '<td><a href="user.php?search=' . $searchId . '&user=' . $row['screen_name'] . '">' . $row['screen_name'] . '</a> [' . $row['statuses_count'] . ']</td>'
	/*
	. '<td><a href="user.php?search=' . $searchId . '&user=' . $row['screen_name'] . '">' . $row['score'] . '</a></td>'
	. '<td><a href="http://twitter.com/' . $row['screen_name'] . '" title="' . $row['name'] . ' @ ' . $row['location'] . '">' . $row['screen_name'] . '</a> [' . $row['statuses_count'] . ']</td>' 
	*/
	. append_td('Iter', intval($row['iter'])-1)
	. append_td('Followers / Friends', $row['followers_count'].' / '.$row['friends_count']) 
	. append_td('Socialness', $row['chattiness']) 
	. append_td('Feedness', $row['feedness'])
	. append_td('Retweeted Mean', $row['retweeted_mean'])
	. append_td('Retweet Ratio', $row['retweet_ratio'])
	. append_td('Term Variation', $row['term_variation'])
	. append_td('#RelatedTweets / Tweets (including_retweets)', $row['search_relateness'])
	. append_td('#TotalRetweetsOfRelatedTweets / #RelatedTweets', $row['rating_of_related_tweets'])
	. '<td>' . number_format( doubleval($row['search_relateness']) * doubleval($row['rating_of_related_tweets']) ,3) . '</td>'
	. '<td>' . number_format( doubleval($row['search_relateness']) * doubleval($row['rating_of_related_tweets']) * doubleval($row['score']) ,3) . '</td>'
	. '</tr>';
}
closeCon($con);

function append_td($tooltip, $val) {
	return '<td><a href="" class="tag_cloud" rel="twipsy" data-original-title="' . $tooltip . '">' . $val . '</a></td>';
}

?>
</tbody>
</table>

<!----------------------------------------- </user_rank_table> ------------------------------------------------------------------------------>

<?php include_once 'postprocess.php'; ?>
